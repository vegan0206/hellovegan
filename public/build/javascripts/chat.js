function sendMsg(e){socket.emit("send-msg",e)}var socket=io("ws://127.0.0.1:3000"),vm=new Vue({el:"#webChat",data:{nickname:"",sendId:0,msgData:"",currentTargetId:0,contacts:[],message:[]},watch:{},mounted:function(){this.$nextTick(function(){this.sendId&&this.currentTargetId&&socket.emit("get-message-list",{userId:this.sendId,targetId:this.currentTargetId})})},computed:{classObject:function(){return{"text-right":!1}}},methods:{login:function(){""!=this.nickname&&socket.emit("reg-user",{nickname:this.nickname})},getMsgList:function(e){this.currentTargetId=e.userId,this.sendId&&this.currentTargetId&&socket.emit("get-message-list",{userId:this.sendId,targetId:this.currentTargetId})},sendMsg:function(){socket.emit("send-msg",{sendId:this.sendId,recvId:this.currentTargetId,msgData:this.msgData,msgType:1,msgTime:Date.now()}),this.msgData=""}}});socket.on("connect",function(){console.info("连接服务器成功"),vm.nickname&&socket.emit("reg-user",{nickname:vm.nickname})}),socket.on("reconnect",function(){console.log("重新连接到服务器")}),socket.on("reg-user-response",function(e){vm.sendId=e.sendId}),socket.on("get-message-list",function(e){vm.message=e}),socket.on("recv-msg",function(e){e.forEach(function(e){console.log(e.recvId,vm.currentTargetId),e.recvId==vm.currentTargetId&&vm.message.push(e)})}),socket.on("get-contacts",function(e){console.log("contacts = ",e),0!=e.length&&(vm.contacts=e,vm.currentTargetId=e[0].userId||0,vm.sendId&&vm.currentTargetId&&socket.emit("get-message-list",{userId:vm.sendId,targetId:vm.currentTargetId}))}),socket.on("update-contacts",function(e){vm.contacts=e});