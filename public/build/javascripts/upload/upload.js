!function(e,i){function t(e,t,a,n){i("#"+e).on("change",function(){var e=new FileReader,n=this.files[0],o=this,s=i(this).attr("data-type");if(s&&n.type.indexOf(s)==-1)return void alert("type error~");e.readAsDataURL(n);t.name=n.name.length>30?n.name.substring(n.name.length-30):n.name,e.onload=function(e){var n="<img src="+this.result+" class='img-responsive center-block view-user-img' id='view-user-img' />";t.img=encodeURIComponent(this.result),i("#modal-user-img .view-img-container").append(n),i(o).val(""),i("#view-user-img").on("load",function(){var e=a.boxWidth,t=i("#modal-user-img .view-img-container").height();t=0==t?570:t,t<e*a.aspectRatio?e=t*a.aspectRatio:t=e,a.setSelect=[0,0,e,t],i(this).Jcrop(a),i("#user-img-action").click()})}}),i("#modal-user-img .ok").on("click",function(){if(t.data){i("#modal-user-img .view-img-container").empty();var e='<a style="position:static; margin-left:10px;" class=" alert alert-success alert-note" data-dismiss="alert" href="#" aria-hidden="true">'+globalData.BI0177+"</a>";i(".change-img-body").append(e),i.ajax({url:"/upload/img-cut",type:"post",data:t,success:function(e){i(".alert-note").remove(),n&&n.call(this,e)}})}}),i("#modal-user-img .cancel").on("click",function(){i("#modal-user-img .view-img-container").empty()})}e.upload=function(e,a,n){e||(e="change-user-img"),a||(a={});var o={},s={boxWidth:570,aspectRatio:1,width:200,onSelect:function(e){e&&(o.data=JSON.stringify(e),o.size=s.width+","+s.width*s.aspectRatio)}};s=i.extend(s,a),t(e,o,s,n)}}(window,$);